@model ForumTopicModel
@{
	ViewData["Title"] = $"TASVideos Forum {Model.Title}";
}
<partial Name="_ForumHeader" />
<fullrow>
	<a permission="MoveTopics" asp-action="MoveTopic" asp-route-id="@Model.Id" class="btn btn-sm btn-warning" title="Move this topic"><i class="fa fa-location-arrow"></i></a>
	<a permission="SplitTopics" asp-action="SplitTopic" asp-route-id="@Model.Id" class="btn btn-sm btn-warning" title="Split this topic"><i class="fa fa-code-fork"></i></a>
	<form style="display: inline" class="form-inline" permission="LockTopics" method="POST" asp-action="SetTopicLock" asp-route-topicId="@Model.Id" asp-route-topictitle="@Model.Title" asp-route-locked="@(!Model.IsLocked)" asp-route-returnUrl="@Context.ReturnUrl()">
		<button type="submit" class="btn @(Model.IsLocked ? "btn-success" : "btn-warning") btn-sm">
			<span condition="Model.IsLocked" title="Unlock this topic">
				<i class="fa fa-unlock"></i>
			</span>
			<span condition="!Model.IsLocked" title="Lock this topic">
				<i class="fa fa-lock"></i>
			</span>
		</button>
	</form>
	<small class="@(Model.IsLocked ? "alert alert-danger" : "") pt-1 pb-2">
		<a asp-action="Index">Forum</a> -> <a asp-action="Subforum" asp-route-id="@Model.ForumId">@Model.ForumName</a> -> @Model.Title <span condition="Model.IsLocked"> (Locked)</span>
	</small>
	<a condition="ViewData.UserHas(PermissionTo.PostInLockedTopics) || (!Model.IsLocked && ViewData.UserHas(PermissionTo.CreateForumPosts))" asp-action="CreatePost" asp-route-topicId="@Model.Id" class="btn btn-primary btn-sm pull-right">
		<span class="fa fa-plus"></span> Post
	</a>
</fullrow>

@if (Model.Poll != null)
{
	<hr />
	<partial name="_Poll" model="Model.Poll" />
}

<hr class="mt-1" />
<fullrow>
	<partial name="~/Views/Table/_Pager.cshtml" model="Model.Posts" />
</fullrow>
@foreach (var post in Model.Posts.OrderBy(p => p.CreateTimestamp).ToList())
{
	<card class="@(post.Highlight ? "border-info" : "")">
		<cardheader>
			<row>
				<div class="col-4 border-right">
					<h5>@post.PosterName</h5>
				</div>
				<div class="col-8 pt-0 pb-0">
					<small style="display: inline-block">
						<a id="@post.Id" href="/Forum/Post/@(post.Id)#@post.Id" title="Link to this post" class="pull-left"><i class="fa fa-bookmark-o"></i></a>
						Posted: @post.CreateTimestamp
						<span condition="!string.IsNullOrWhiteSpace(post.Subject)">Post subject: @post.Subject</span>
					</small>
					<small class="pull-right" style="display: inline-block">
						<a class="btn btn-info btn-sm" asp-action="CreatePost" asp-route-topicId="@Model.Id" asp-route-quoteId="@post.Id">Quote</a>
						<a condition="post.IsEditable" class="btn btn-primary btn-sm" asp-action="EditPost" asp-route-id="@post.Id">Edit</a>
						<delete-button condition="post.IsDeletable" asp-href="@Url.Action($"DeletePost/{post.Id}")" warning-message="Are you sure you want to delete this post?" class="btn-sm"><i title="Delete this post" class="fa fa-remove"></i></delete-button>
					</small>
				</div>
			</row>
		</cardheader>
		<cardbody>
			<row>
				<div class="col-4">
					<div class="card-text text-right">
						<small>
							@string.Join(",", post.PosterRoles)
							(todo points)
						</small>
						<br />
						<img src="@post.PosterAvatar" />
						<br />
						<small>
							Joined: @post.PosterJoined.ToShortDateString()<br />
							Posts: @post.PosterPostCount<br />
							Location: @post.PosterLocation
						</small>
					</div>
				</div>
				<div class="col-8">
					@Html.Raw(post.RenderedText)
				</div>
			</row>
		</cardbody>
		<cardfooter>
			<fullrow>
				<small style="font-style: italic">@Html.Raw(post.RenderedSignature)</small>
				<br />
				<a class="btn btn-info btn-sm" asp-controller="User" asp-action="Profile" asp-route-userName="@post.PosterName">Profile</a>
				<a class="btn btn-secondary btn-sm" condition="User.Identity.IsAuthenticated" asp-controller="Messages" asp-action="Create" asp-route-toUser="@post.PosterName">PM</a>
				<div class="pull-right">
					@foreach (var award in post.Awards.OrderByDescending(a => a.Year))
					{
						<partial name="../Shared/_Award.cshtml" model="award" />
					}
				</div>
			</fullrow>
		</cardfooter>
	</card>
}
<fullrow class="mt-2">
	<partial name="~/Views/Table/_Pager.cshtml" model="Model.Posts" />
</fullrow>
	
