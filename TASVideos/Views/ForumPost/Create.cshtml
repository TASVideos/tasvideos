@model ForumPostCreateModel
@{
	ViewData["Title"] = $"Posting to Forum Topic: {Model.TopicTitle}";
}

<h4>@ViewData["Title"]</h4>

<form asp-action="Create" form-method="POST">
	<form-group class="col-lg-6">
		<row>
			<label asp-for="Subject" class="form-control-label"></label>
			<input type="text" asp-for="Subject" class="form-control" autocomplete="off" />
			<span asp-validation-for="Subject" class="text-danger"></span>
		</row>
	</form-group>
	<form-group>
		<div class="btn-group mt-1 mb-1">
			<button type="button" class="btn btn-info btn-sm"><strong>b</strong></button>
			<button type="button" class="btn btn-info btn-sm"><i>i</i></button>
			<button type="button" class="btn btn-info btn-sm"><s>s</s></button>
			<button type="button" class="btn btn-info btn-sm"><sub>sub</sub></button>
			<button type="button" class="btn btn-info btn-sm"><sup>sup</sup></button>

		</div>

		<div class="btn-group mt-1 mb-1">
			<button type="button" class="btn btn-info btn-sm">quote</button>
			<button type="button" class="btn btn-info btn-sm">url</button>
			<button type="button" class="btn btn-info btn-sm">img</button>
			<button type="button" class="btn btn-info btn-sm">code</button>
			<button type="button" class="btn btn-info btn-sm">noparse</button>
			<button type="button" class="btn btn-info btn-sm">spoiler</button>

		</div>

		<div class="btn-group mt-1 mb-1">
			<button type="button" class="btn btn-secondary btn-sm">tt</button>
			<button type="button" class="btn btn-secondary btn-sm">list</button>
			<button type="button" class="btn btn-secondary btn-sm">list=</button>
		</div>

		<div class="btn-group mt-1 mb-1">
			<button type="button" class="btn btn-secondary btn-sm">left</button>
			<button type="button" class="btn btn-secondary btn-sm">right</button>
			<button type="button" class="btn btn-secondary btn-sm">center</button>
		</div>

		<div class="btn-group mt-1 mb-1">
			<button type="button" class="btn btn-success btn-sm">frames</button>
			<button type="button" class="btn btn-success btn-sm">video</button>
			<button type="button" class="btn btn-success btn-sm">google</button>
			<button type="button" class="btn btn-success btn-sm">thread</button>
			<button type="button" class="btn btn-success btn-sm">post</button>
			<button type="button" class="btn btn-success btn-sm">movie</button>
			<button type="button" class="btn btn-success btn-sm">submission</button>
			<button type="button" class="btn btn-success btn-sm">wiki</button>
			<button type="button" class="btn btn-success btn-sm">userfile</button>
		</div>
	</form-group>
	<form-group>
		<textarea asp-for="Post" class="form-control" rows="20"></textarea>
		<span asp-validation-for="Post" class="text-danger"></span>
	</form-group>
	<div class="text-center">
		<button type="button" class="btn btn-secondary" id="preview-button">Preview</button>
		<button type="submit" class="btn btn-primary">Save</button>
		<a asp-controller="ForumTopic" asp-action="Index" asp-route-id="@Model.TopicId" class="btn btn-secondary">Cancel</a>
	</div>
</form>

<div class="d-none" id="preview-container">
	<hr />
	<label>Preview:</label>
	<button class="btn btn-secondary">Update</button>
	<div id="preview-contents" class="mt-3" style="border: solid; padding: 5px; border-radius: 5px"></div>
</div>

<script>
	(function () {
		document.getElementById('preview-button').onclick = function () {
			var markup = document.getElementById('@nameof(Model.Post)').value;
			document.getElementById('preview-container').classList.remove('d-none');
			var xmlhttp = new XMLHttpRequest();
			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState === XMLHttpRequest.DONE) {
					if (xmlhttp.status === 200) {
						document.getElementById('preview-contents').innerHTML = xmlhttp.responseText;
					} else {
						alert("Could not generate preview");
					}
				}
			};

			xmlhttp.open("POST", "/ForumTopic/@(nameof(ForumTopicController.GeneratePreview))");
			xmlhttp.send(markup);
		}
	})();
</script>

@section Scripts {
	@await Html.PartialAsync("_ValidationScriptsPartial")
}
