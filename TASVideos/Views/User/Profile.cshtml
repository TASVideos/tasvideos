@model UserProfileModel
@{
	ViewData["Title"] = $"Profile for {Model.UserName}";
}

<a condition="@ViewData.UserHas(PermissionTo.EditUsers)" asp-action="Edit" asp-route-id="@Model.Id" class="pull-right btn btn-primary">Edit</a>

<row>
	<div class="col-md-6">
		<card>
			<cardheader><h4>@Model.UserName</h4></cardheader>
			<cardbody>
				<img condition="@(!string.IsNullOrWhiteSpace(Model.Avatar))" src="@Model.Avatar" style="float: right"/>
				<div class="card-text">
					<a href="/HomePages/@Model.UserName">Homepage</a>
					<br/>
					<label asp-for="JoinDate"></label>
					<label>@Model.JoinDate.ToShortDateString()</label>
					<br/>
					<label asp-for="LastLoggedInTimeStamp"></label>
					<label>@Model.LastLoggedInTimeStamp?.ToShortDateString()</label>
					<br/>
					<label asp-for="Location"></label>
					<label>@Html.DisplayFor(m => m.Location)</label>
					<br/>
					<label asp-for="PostCount"></label>
					<label><a asp-controller="Forum" asp-action="UserPosts" asp-route-id="@Model.UserName">@Html.DisplayFor(m => m.PostCount)</a></label>
					<br/>
					<div class="pull-right mt-2">
						@foreach (var award in Model.Awards.OrderByDescending(a => a.Year))
						{
							<partial name="../Shared/_Award.cshtml" model="award"/>
						}
					</div>
				</div>
			</cardbody>
			<div condition="!string.IsNullOrWhiteSpace(Model.Signature)" class="card-footer">
				@Html.Raw(Model.Signature)
			</div>
		</card>
		<card>
			<cardheader><h4>Roles</h4></cardheader>
			<cardbody>
				@if (Model.Roles.Any())
				{
					foreach (var role in Model.Roles)
					{
						<label><a asp-controller="Roles" asp-action="Index" asp-route-role="@role.Name">@role.Name</a></label>
						<div class="ml-3 mt-1 mb-3">@role.Description</div>
					}
				}
				else
				{
					<div class="alert alert-danger">This user has no Roles</div>
				}
			</cardbody>
		</card>
	</div>
	<div class="col-md-6">
		<card class="text-right">
			<cardheader><h4>Publications</h4></cardheader>
			<cardbody>
				<div condition="!Model.AnyPublications" class="card-text">
					<i>User has not had any Published Movies</i>
				</div>
				<div condition="Model.AnyPublications">
					<p>@Html.DisplayNameFor(m => m.PlayerPoints) @Model.PlayerPoints</p>
					<p>
						<a href="/Movies-Author@(Model.Id)">@Model.PublicationActiveCount</a>
						Active,
						<a href="/Movies-Author@(Model.Id)-obs">@Model.PublicationObsoleteCount</a>
						obsolete
					</p>
					<p>Has published movies on these systems: @string.Join(", ", Model.PublishedSystems)</p>
				</div>
			</cardbody>
		</card>
		<card class="text-right">
			<cardheader><h4>Submissions</h4></cardheader>
			<cardbody>
				<div condition="Model.SubmissionCount == 0" class="card-text">
					<i>User has not had any Submissions</i>
				</div>
				<div condition="Model.SubmissionCount > 0" class="card-text">
					<p><a asp-controller="Submission" asp-action="List" asp-route-user="@Model.UserName">@Model.SubmissionCount</a> Total</p>
					@foreach (var sub in Model.Submissions.OrderByDescending(s => s.Count))
					{
						<label>
							<a asp-controller="Submission" asp-action="List" asp-route-user="@Model.UserName" asp-route-statusfilter="@((int)sub.Status)">@sub.Count</a>
							@sub.Status.EnumDisplayName()
						</label>
						<br />
					}
				</div>
			</cardbody>
		</card>
		<card class="text-right" condition="Model.WikiEdits.TotalEdits > 0">
			<cardheader><h4>Wiki</h4></cardheader>
			<cardbody>
				<div>
					<p><a asp-controller="Wiki" asp-action="UserEditHistory" asp-route-username="@Model.UserName">@Model.WikiEdits.TotalEdits</a> Total Edits</p>
					<label>Last Edit On: @Model.WikiEdits.LastEdit?.ToShortDateString()</label>
					<label>First Edit on: @Model.WikiEdits.FirstEdit?.ToShortDateString()</label>
				</div>
			</cardbody>
		</card>
		<card class="text-right">
			<cardheader><h4>Ratings</h4></cardheader>
			<cardbody>
				TODO
			</cardbody>
		</card>
	</div>
</row>